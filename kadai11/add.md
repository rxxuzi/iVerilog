# 加算回路

## add.v

このVerilogコードは、4ビットの2つの入力（aとb）と1ビットのキャリー入力（cin）を受け取り、4ビットの出力（q）と1ビットのキャリーアウト（cout）を生成する4ビット加算器（Adder）を定義しています。

- `add.v`モジュール:
  - `input [3:0] a, b;`: 4ビットの入力信号aとbを受け取ります。それぞれの信号は4ビットの幅を持っています。
  - `input cin;`: 1ビットのキャリー入力信号cinを受け取ります。
  - `output [3:0] q;`: 4ビットの出力信号qを生成します。
  - `output cout;`: 1ビットのキャリーアウト信号coutを生成します。

  - 4ビット加算器の動作を記述しています。
    - `assign {cout, q} = a + b + cin;`: 出力信号qとcoutに、入力信号aとb、およびcinを加算した結果を代入します。
    - `{cout, q}`は連結演算子で、キャリーアウトと出力信号を1つの信号に結合しています。

この加算器は、入力信号aとbの各ビットにキャリーを加えて4ビットの結果を出力します。出力信号qは4ビットの加算結果を表し、coutは最上位ビットでのキャリーアウトを示します。

~~~v
         0 a=0 b=0 cin=0 q=0 cout=0
    100000 a=0 b=0 cin=1 q=1 cout=0
    200000 a=1 b=1 cin=0 q=2 cout=0
    300000 a=1 b=1 cin=1 q=3 cout=0
    400000 a=f b=f cin=0 q=e cout=1
    500000 a=f b=f cin=1 q=f cout=1
~~~

## 減算回路

減算回路の基本

$ q = a - b $　と $ q = a + (-b) $ は等しい
よって $-b$を実現させるには $~b + 1$をすると良い.

~~~v
(a,b) = (10,5)
10     = 00001010 // <- a
 5     = 00000110
~5     = 11111001
~5 + 1 = 11111010 // <- -b
~~~

実装

~~~verilog
wire dummy;

addca sub(a, ~b, 1'b1, q, dummy);
~~~

- `~b`: 入力信号bのビットを反転した結果を表します。これにより、bの1の補数を計算しています。
- `1'b1`: キャリー入力信号cinを1に設定しています。これは2の補数法において減算を意味します。
- `addca sub(a, ~b, 1'b1, q, dummy);`: `addca`モジュール（加算器）をインスタンス化しています。ただし、入力bをビット反転してから、キャリー入力を1に設定しています。このような設定により、2の補数法に基づく減算が実現されます。

したがって、このコードは減算回路を表しており、入力aとbの差を出力信号qに計算します。キャリーアウト信号は`dummy`ワイヤに接続されていますが、減算の場合、通常は使用されません。

~~~v
         0 a=0 b=0 q=0
    100000 a=1 b=0 q=1
    200000 a=0 b=1 q=f
    300000 a=f b=e q=1
    400000 a=e b=f q=f
~~~